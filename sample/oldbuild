import org.jetbrains.kotlin.gradle.plugin.* // Import the Kotlin/Native plugin
import org.gradle.api.tasks.Exec // This runs binaries

// Include Kotlin/Native
buildscript {
    repositories {
        mavenCentral()
        maven { setUrl("https://dl.bintray.com/jetbrains/kotlin-native-dependencies") }
    }

    dependencies {
        classpath("org.jetbrains.kotlin:kotlin-native-gradle-plugin:+")
    }
}

apply {
	plugin<KonanPlugin>()
}

configure<KonanArtifactsContainer> {
	create("sample", closureOf<KonanCompilerConfig> {
		inputDir("src/")
		outputDir("../out/")

		library("../out/sdk.klib.klib") //BUG: Naming, interop, etc

		// HACK: Include GTK
		library("../sdk/native/build/konan/interopCompiledStubs/gtkInteropStubs/gtkInteropStubs.klib.klib")
		linkerOpts("-L/usr/lib/x86_64-linux-gnu -lglib-2.0 -lgdk-3 -lgtk-3 -lgio-2.0 -lgobject-2.0")

		enableOptimization() // Make smaller binaries at expense of compile time
	})
}

// A task that runs the output file.
task<Exec>("run") {
	dependsOn("build")
	commandLine("../out/sample.kexe")
}